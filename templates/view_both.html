<!-- templates/view_both.html -->
{% extends 'base_template.html' %}

{% block custom_style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/grid_styles.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/button_styles.css') }}">
<style>
    .image-grid, .single-page {
        display: none;  /* é»˜è®¤éšè— */
    }
    .visible {
        display: block;  /* åªæœ‰å¸¦æœ‰ visible ç±»çš„å…ƒç´ æ˜¾ç¤º */
    }
    .image-grid.visible {  
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        grid-gap: 20px;
    }
    img {
        display: block;
        width: 75%;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        margin: 0 auto 20px;  /* ä¸Šä¸‹è¾¹è·åˆ†åˆ«æ˜¯ 0 å’Œ 20pxï¼Œå·¦å³è¾¹è·è‡ªåŠ¨å±…ä¸­ */
    }
</style>
{% endblock %}

{% block page_content %}
<div class="container">
    <h1>{{ metadata.name }}</h1>
    <!-- ğŸ“Œ æ’å…¥ metadata å€å¡Š -->
    {% include 'components/_metadata_panel.html' %}

    <!-- æ·»åŠ åˆ‡æ¢æ’åºçš„æŒ‰é’® -->
    <button id="sortButton" class="button">Toggle Sort</button>
    <div class="toggle-button" onclick="toggleView()">Switch View</div>
    <a href="/" class="button">Home</a>

    <!-- Grid View -->
    <div id="gridView" class="image-grid visible">
        {% for image in data %}
        <div class="image-item" data-url="{{ image.url }}">
            <a href="{{ image.url }}">
                <img src="{{ image.thumbnail_route }}" alt="Image">
                <div class="image-overlay">
                    <span>{{ image.name }}</span>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- Single Page View -->
    <div id="singlePageView" class="single-page">
        {% for image in data %}
        <img src="{{ image.url }}" alt="Comic Image">
        {% endfor %}
    </div>
</div>

<script>
    // ç¡®ä¿è„šæœ¬åœ¨é¡µé¢åŠ è½½åæ‰§è¡Œ
    window.onload = function() {
        let isAscending = true; // å½“å‰æ’åºçŠ¶æ€

        function toggleSort() {
            // è·å– gridView ä¸­çš„æ‰€æœ‰å›¾ç‰‡é¡¹
            const gridView = document.getElementById('gridView');
            const items = Array.from(gridView.children);

            // æ ¹æ®æ’åºçŠ¶æ€è°ƒæ•´é¡ºåº
            items.sort((a, b) => {
                const pathA = a.getAttribute('data-url');
                const pathB = b.getAttribute('data-url');
                return isAscending ? pathA.localeCompare(pathB) : pathB.localeCompare(pathA);
            });

            // æ›´æ–° DOM é¡ºåº
            items.forEach(item => gridView.appendChild(item));

            // åˆ‡æ¢æ’åºçŠ¶æ€
            isAscending = !isAscending;
        }

        // ç»‘å®šäº‹ä»¶åˆ°æŒ‰é’®
        document.getElementById('sortButton').onclick = toggleSort;

        // åˆ‡æ¢è§†å›¾åŠŸèƒ½
        function toggleView() {
            // console.log("Switch View button clicked"); // è°ƒè¯•ä¿¡æ¯
            var gridView = document.getElementById('gridView');
            var singlePageView = document.getElementById('singlePageView');

            if (gridView.classList.contains('visible')) {
                // console.log("Switching to Single Page View");
                gridView.classList.remove('visible');
                singlePageView.classList.add('visible');
            } else {
                // console.log("Switching to Grid View");
                singlePageView.classList.remove('visible');
                gridView.classList.add('visible');
            }
        }

        // å°†å‡½æ•°èµ‹å€¼ç»™æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
        document.querySelector('.toggle-button').onclick = toggleView;
    };
</script>
{% endblock %}